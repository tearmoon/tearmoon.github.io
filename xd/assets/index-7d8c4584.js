import{c as E,D as L,r as m,T as u,U as v,V as S,G as b}from"./vendor-60d7ee8f.js";function h(s,c,r,n){return s.addEventListener(c,r,n),S(s.removeEventListener.bind(s,c,r,n))}function y(s,c,r,n){const e=()=>{u(v(s)).forEach(a=>{a&&u(v(c)).forEach(i=>h(a,i,r,n))})};typeof s=="function"?L(e):m(e)}function k(s,c,r){const[n,e]=E();return y(s,c,e,r),n}var p=(s,c,r=[])=>{const n=new WebSocket(s,c),e=n.send.bind(n);return n.send=a=>n.readyState==1?e(a):r.push(a),n.addEventListener("open",()=>{for(;r.length;)e(r.shift())}),n},w=(s,c,r={})=>{let n=r.retries||1/0,e;const a=[];let i=[["close",()=>{n-- >0&&setTimeout(d,r.delay||3e3)}]];const d=()=>{e&&e.readyState<2&&e.close(),e=Object.assign(p(s,c,a),{reconnect:d}),i.forEach(t=>e.addEventListener(...t))};d();const f={close:(...t)=>(n=0,e.close(...t)),addEventListener:(...t)=>(i.push(t),e.addEventListener(...t)),removeEventListener:(...t)=>(i=i.filter(o=>t[0]!==o[0]||t[1]!==o[1]),e.removeEventListener(...t)),send:t=>{var o,l;return(l=(o=f.send).before)==null||l.call(o),e.send(t)}};for(let t in e)f[t]==null&&Object.defineProperty(f,t,{enumerable:!0,get:()=>typeof e[t]=="function"?e[t].bind(e):e[t]});return f},O=(s,c,r)=>{const n=w(s,c,r);return b(()=>n.close()),n};export{k as a,O as c};
